<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.stock.webpage.mapper.StrategyDetailMapper">

    <!-- action + signalDate -->
    <select id="selectByActionAndSignalDateOrderBySpecialValueAsc" resultType="StrategyDetailDto">
        SELECT
            result_id      AS resultId,
            signal_date    AS signalDate,
            code,
            name,
            action,
            price,
            prev_close     AS prevClose,
            diff,
            volume,
            special_value  AS specialValue,
            created_at     AS createdAt
        FROM strategy_detail
        WHERE action = #{action}
          AND signal_date = #{signalDate}
        ORDER BY special_value ASC
    </select>

    <!-- action 기준 최신순 -->
    <select id="selectByActionOrderBySignalDateDesc" resultType="StrategyDetailDto">
        SELECT
            result_id      AS resultId,
            signal_date    AS signalDate,
            code,
            name,
            action,
            price,
            prev_close     AS prevClose,
            diff,
            volume,
            special_value  AS specialValue,
            created_at     AS createdAt
        FROM strategy_detail
        WHERE action = #{action}
        ORDER BY signal_date DESC
    </select>

    <!-- 키워드 검색 -->
    <select id="selectByKeyword" resultType="StrategyDetailDto">
        SELECT
            result_id      AS resultId,
            signal_date    AS signalDate,
            code,
            name,
            action,
            price,
            prev_close     AS prevClose,
            diff,
            volume,
            special_value  AS specialValue,
            created_at     AS createdAt
        FROM strategy_detail
        WHERE
            name   LIKE CONCAT('%', #{keyword}, '%')
           OR code LIKE CONCAT('%', #{keyword}, '%')
           OR action LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY signal_date DESC, special_value ASC
    </select>

</mapper>

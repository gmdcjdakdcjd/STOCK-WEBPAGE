<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.stock.webpage.mapper.BatchHistoryMapper">

    <!-- 날짜 목록 조회 -->
    <select id="selectHistoryDateList"
            resultType="com.stock.webpage.dto.BatchDateGroupDTO">

        SELECT
        exec_date AS execDate,
        COUNT(*)  AS totalCount
        FROM batch_history_v
        GROUP BY exec_date
        ORDER BY exec_date DESC
        LIMIT #{offset}, #{size}

    </select>

    <!-- 날짜 목록 전체 개수 -->
    <select id="selectHistoryDateTotalCount"
            resultType="int">

        SELECT COUNT(DISTINCT exec_date)
        FROM batch_history_v

    </select>

    <!-- 특정 날짜 상세 조회 -->
    <select id="selectHistoryByDate"
            resultType="com.stock.webpage.dto.BatchHistoryView">

        SELECT
        exec_date      AS execDate,
        type           AS type,
        hist_id        AS histId,
        job_id         AS jobId,
        job_name       AS jobName,
        exec_status    AS execStatus,
        exec_message   AS execMessage,
        exec_start_time as execStartTime,
        exec_end_time   as execEndTime,
        duration_ms     as durationMs
        FROM batch_history_v
        WHERE exec_date = #{date}
        ORDER BY exec_start_time DESC
        LIMIT #{offset}, #{size}

    </select>

    <!-- 특정 날짜 전체 개수 -->
    <select id="selectHistoryDetailTotalCount"
            resultType="int">

        SELECT COUNT(*)
        FROM batch_history_v
        WHERE exec_date = #{date}

    </select>

</mapper>